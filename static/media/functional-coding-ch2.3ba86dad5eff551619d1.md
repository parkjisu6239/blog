# [Functional Coding] Chap2. 현실에서의 함수형 사고.
> 현실적인 문제에 함수형 사고를 적용해보자.

## TL;DR
- 액션, 계산, 데이터를 구분하는 일은 함수형 프로그래머에게 가장 중요하다.
- 함수형 프로그래머는 유지보수를 잘 하기 위해 계층형 설계를 사용한다. 각 계층은 코드의 변경 가능성에 따라 나눈다.
- 타임라인 다이어그램은 시간에 따라 변하는 액션을 시각화하는 방법이다.
- 액션간 협력을 위해 타임라인 커팅을 살펴보자.


## 함수형 프로그래머가 적용할 것
1. 파트1 : 액션과 계산, 데이터
	- 액션과 계산, 데이터를 구분한다.
	- `계층적 설계` 원칙이 어떤 것인지 알아보자.
2. 파트2 : 일급 추상
	- 분산 시스템을 구축한다.
	- `타임라인 다이어그램`을 사용했다.
	- 함수를 인자로 받는 `일급함수`를 사용하여 효과적으로 코드를 짤 수 있다.

## 파트 1: 액션과 계산 데이터
함수형 프로그래머는 코드를 액션, 계산, 데이터로 구분해야 한다. 피자 만들기 과정을 세 가지로 분류해보자.
- 액션 : 호출 횟수와 시점에 의존한다.
- 계산 : 인자에만 의존한다. 실행시 다른곳에 영향을 주지 않는다.
- 데이터 : 변경 불가능한 데이터, 해석이 필요하다.

### 변경 가능성에 따라 코드 나누기
코드를 변경 가능성에 따라 나누어보자. 위쪽에 두면 자주 변하는 것, 아래쪽은 거의 변하지 않는 것으로 나눈다. 분명한 것은 자바스크립트 언어 자체나, 자료구조와 같은 것들은 거의 변하지 않는다. 따라서 계층적 구조에서 가장 아래쪽에 위치하게 된다.

가운데는 바뀔 수 있지만 자주 바뀌지 않는 도메인 규칙을 둔다. 가장 위는 비즈니스 규칙이 위치한다.

각 계층은 그 아래에 있는 계층을 기반으로 만들어진다. 각 계층을 안정적으로 만드는 방법은 그 아래에 있는 기반을 안정적으로 하는 것이다. 가장 위에 있는 코드는 의존성이 없기 때문에 바꾸기 쉽고, 아래쪽은 의존성이 많아 바꾸기 어렵지만, 잘 바뀌지 않는다.

함수형 프로그래머는 이것을 `계층적 설계` 부르며, 일반적으로 
- `비즈니스 규칙`
- `도메인 규칙`
- `기술 스택`
으로 나눈다. 계층형 설계로 만든 코드는 테스트, 재사용, 우지보수가 쉽다.

## 파트 2: 일급 추상
`타임라인 다이어그램`은 코드 실행을 시간 순서대로 나열한 것이다. 이를 사용하면 액션이 시간 순서에 따라 어떻게 실행되는지 볼 수 있다. 액션을 실행 순서에 의존하기 때문에 타임라인 다이어그램을 이용하면 효율적으로 코드를 짤 수 있고 오류를 줄일 수 있다.

### 분산 시스템을 타임라인으로 시각화 하기
모든 액션을 순차적으로(직렬)로 수행하지 않고 분산 시스템을 사용한다면 어떻게 할까? 이를 잘 해결하기 위해서 타임라인으로 시각화하는 방법이 있다. 순서에 상관없이 실행될 코드와, 순서대로 실행되어야 하는 코드를 구분해야한다.

분산 시스템에서 서로 다른 타임라인을 가지게 되면, 일의 순서를 보장할 수 없어진다는 점에 주의하자.

### 각각의 타임라인은 다른 순서로 실행됩니다.
타임라인이 분리되면 각각의 실행 순서를 보장할 수 없게 된다. 3개의 분산 환경으로 나눈후에 각각이 특정 작업을 나누어 진행하는 경우, 서로는 서로의 작업이 완료된지 모른다. `타임 라인은 서로 맞추지 않은 분산 시스템은 예측 불가능한 순서로 실행된다.`

### 분산 시스템에서 주의할 점
1. 타임라인은 서로의 순서를 맞추지 않는다.
2. 액션이 실행되는 시간은 중요하지 않다.(얼마나 걸리는지)
3. 타이밍이 어긋나는 경우는 실제로 일어난다.
4. 타임라인 다이어그램으로 시스템의 문제를 알 수 있다.

간단한 예로, js의 여러 함수가 동시에 서버 리소스를 가져온다고 하자. 별도의 추가 작업을 하지 않았다면 비동기로 수행될 것이고, 어떤 리소스가 먼저 도착할지 모른다. 또한, 모든 리소스를 받아온 이후에 다음 작업이 진행되리라는 것은 전혀 보장되지 않는다.

### 타임라인 커팅 : 로봇이 서로를 기다릴 수 있게 하기
타임라인 커팅은 여러 타임라인이 동시에 진행될 때 서로 순서를 맞추는 방법이다. 타임라인의 각 작업들이 모두 완료된 이후에 다음 작업이 진행되어야 하는 경우, 중간에 타임라인은 커팅함으로써 시각적으로 구분할 수 있다.

js를 생각해보면, 각 리소스 fetch를 [all](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/all) 로 묶어준 후에 다음 작업을 진행하는 방식이라고 이해하면 된다.

### 타임라인에 대해 배운 것
1. 타임라인 커팅으로 서로 다른 작업들을 쉽게 이해할 수 있다.
2. 타임라인 다이어그램을 사용하면 시간에 따라 진행하는 작업을 쉽게 이해할 수 있다.
3. 타임라인 다이어그램은 유연하다.